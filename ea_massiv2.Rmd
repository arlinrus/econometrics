---
title: "Анализ социального, экологического и управленческих секторов"
author: 
  - Астапенкова А. В.
  - Сорокина Е. А.
  - Умыскова Д. И.
  - Палакян А. С.
  - Осипова М. А.
  - Казначеев И. П.
date: "`r format(Sys.time(), '%d %B %Y')`"
output: 
  html_document:
    toc: true
    toc_float: true
    toc_collapsed: false
    theme: flatly
    highlight: tango
    number_sections: false
    df_print: paged
    code_folding: hide
editor_options: 
  markdown: 
    wrap: sentence
---
```{r, include=FALSE}
library(readxl)
library(lubridate)
library(scales)
#install.packages("readr")
library(dplyr)
library(readr)
#install.packages('janitor')
library(janitor)
library(tidyverse)
library(forcats)
library(tidyr)
library(ggplot2)
#install.packages("stringi")
library(stringi)
```

## Обрабатываем массив

### Краткое описание столбцов в файле EA.xlsx:

*Company Common Name* — название компании.

*Country of Headquarters* — страна расположения штаб-квартиры.

*GICS Industry Name* — отрасль по классификации GICS.

*Year* — год отчётности.

*ESG Score* — общий ESG-рейтинг (Environmental, Social, Governance).

*E Score* — экологическая составляющая ESG.

*S Score* — социальная составляющая ESG.

*G Score* — управленческая составляющая ESG.

*MC* — рыночная капитализация (Market Cap).

*TA* — общие активы (Total Assets).

*ROA* — рентабельность активов (Return on Assets).

*Debt* — долг.

*PP&E* — основные средства (Property, Plant & Equipment).

*CapEx* — капитальные затраты (Capital Expenditures).

*Revenue* — выручка.

*Cash* — денежные средства.

*EBIT* — прибыль до вычета процентов и налогов.

*Tobin Q* — коэффициент Тобина (отношение рыночной стоимости к стоимости активов).

*Leverage* — финансовый леверидж (отношение долга к активам).

*OP_margin* — операционная маржа.

*U–AC*  — натуральные логарифмы соответствующих финансовых показателей (например, ln_MC — логарифм рыночной капитализации).

*Industry* — бинарный показатель отраслевой принадлежности (0 или 1).

### Существуют ли пропуски...? Как мы можем обработать массив, сейчас мы это и узнаем!

#### Посмотрим на данные до преобразования:

```{r}
data_ea <- read_excel("EA.xlsx")
head(data_ea)
```

Заметим, что большинство столбцов имеют пробелы между словами, а также существуют пробелы в целом в строках.
Поэтому преобразуем имена столбцов в чистый формат:

```{r}
data_ea <- read_excel("EA.xlsx")|> clean_names()
head(data_ea)
```

#### Посмотрим на типы переменных, а также пропущенные значения

```{r}
library(visdat)
vis_dat(data_ea)
```

Заметим, что numeric преобладают над character.

```{r}
vis_miss(data_ea)
```

Пропущенных данных в массиве нету.

Изобразим по переменных пропупущенные значения ещё раз, чтобы было нагляднее видно, что по всем данным Na отсутствует.

```{r}
colSums(is.na(data_ea))
```

Заметим, что пропусков в данных нету в обоих графиках.

Теперь обработаем типы переменных и сам массив.
Видим 3 типа chr и 31 num.

```{r}
str(data_ea)
```

```{r}
clean <- function(x){
  if (!is.character(x) && !is.factor(x)) return(x)
  x <- as.character(x)
  x <- ifelse(is.na(x), NA_character_, x)
  x <- str_squish(x)
  str_to_lower(x)
}

data_ea <- data_ea |> mutate(across(where(~ is.character(.) || is.factor(.)), clean))

```

Создадим функцию, в которой обозначим, что если переменные не равны chr и factor, то возвращаем преобразованные значения, которые мы задаем в переменную $x$.
Таким образом, проверяем, является ли значение $x$ пропущенным (NA), и если да, то возвращает строку NA_character\_.
В противном случае, она возвращает исходное значение $x$.

Таким образом мы привели переменные к нижнему регистру и убрали пробелы вначале и вконце слова.

```{r}
summary(data_ea)
glimpse(data_ea)
sum(is.na(data_ea))
#spec(data_ea)
#sapply(data_ea, class)
```

```{r}
data_ea <- data_ea |>
  mutate(
    year = as.integer(year),
    industry = as.integer(industry)
  )
```

Поменяли тип переменных $даты$ и $industry$ на $integer$, так как $double$ не соответствует для года и бинарному показателю отраслевой принадлежности, потому что является натуральным числом.

#### Провериим повторяющиеся значения в данных:

```{r, include=FALSE}
duplicates <- data_ea |>
  group_by(country_of_headquarters, gics_industry_name, year,esg_score,e_score,s_score,g_score, mc, ta, roa, debt, pp_e, cap_ex, revenue, cash, ebit, tobin_q, leverage, op_margin, ln_mc, ln_debt, ln_pp_e, ln_cap_ex, ln_rev, ln_cash, ln_tq, ln_leverage, ln_op_margin, ln_esg, ln_e, ln_s, ln_g, industry) |>
  filter(n() > 1)

# Проверка количества повторов
data_ea |> 
  group_by(country_of_headquarters, gics_industry_name, year,esg_score,e_score,s_score,g_score, mc, ta, roa, debt, pp_e, cap_ex, revenue, cash, ebit, tobin_q, leverage, op_margin, ln_mc, ln_debt, ln_pp_e, ln_cap_ex, ln_rev, ln_cash, ln_tq, ln_leverage, ln_op_margin, ln_esg, ln_e, ln_s, ln_g, industry) |>
  summarise(count = n()) |>
  filter(count > 1)
```

```{r}
total_dup_rows <- duplicates |> nrow()

# Создадим "график" — один столбик
ggplot() +
  geom_col(aes(x = "", y = total_dup_rows), fill = "steelblue") +
  geom_text(aes(x = "", y = total_dup_rows, label = total_dup_rows), vjust = -0.5) +
  labs(title = "Число полностью дублирующихся строк",
       x = NULL, y = "Количество") +
  theme_minimal()
```


*Повторяющихся* значений в данных нету.

#### Посмотрим выбросы для всех финансовых показателей:

```{r}
financial_cols <- c("ln_mc","ln_debt", "ln_pp_e", "ln_cap_ex",
                    "ln_reve", "ln_cash", "ln_tq", "ln_esg",
                    "ln_leverage", "ln_op_margin", "ln_e", "ln_s", "ln_g")

financial_cols <- financial_cols[financial_cols %in% names(data_ea)]

df_long <- data_ea |>
  select(all_of(financial_cols)) |>
  pivot_longer(cols = everything(), names_to = "variable", values_to = "value")

ggplot(df_long, aes(x = variable, y = value)) +
  geom_boxplot(outlier.colour = "red", fill = "lightblue") +
  labs(title = "Выбросы по финансовым показателям",
       x = "Показатель", y = "Значение") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

По боксплот видно, что все финансовые показатели имеют выбросы.
В данном случае, мы *не будем* проводить их очистку, так как в масссиве предоставлены данные разных компаний с разной выручкой.
Удаление выбросов может привести к искажению представления о данных в анализе.

#### Изобразим гистаграмму распределния данных для визаульной наглядности распределения переменных:

```{r}
ggplot(df_long, aes(x=value))+
  geom_histogram(aes(y = ..density..), bins = 30, fill = "skyblue", color = "black") +
  geom_density(color = "red", linewidth = 1) +
  facet_wrap(~ variable, scales = "free") +
  theme_minimal() +
  labs(title = "Распределения логарифмированных показателей",
       x = "Значение", y = "Плотность")
  

```

По графику видно, что распределение у некоторых переменных равномерное, однако некоторые перменные имеют правостороннее распределение из-за большого количества положительных значений.

## Статистический анализ

### Описательная статистика

#### Проверка статистических гипотез

*Гипотеза 1* H0: Компоненты ESG (E, S и G) не оказывают статистически значимого влияния на отношение рыночной стоимости к стоимости активов (ln_tq).
То есть все коэффициенты при ESG-показателях равны нулю.

H1: Хотя бы один из компонентов ESG (E, S или G) оказывает статистически значимое влияние на отношение рыночной стоимости к стоимости активов.

*Гипотеза 2* H0: Отношение рыночной стоимости к стоимости активов не оказывают статистически значимого влияния на компоненты ESG (E, S и G).

H1: Отношение рыночной стоимости к стоимости активов оказываюе статистически значимое влияния на компоненты ESG (E, S и G).

*Гипотеза 1: Влияние E, S, G на tb_q*

Обоснование: Для проверки гипотезы о том, что компоненты ESG (ln_e, ln_s, ln_g) могут быть связаны с отношением рыночной стоимости к стоимости активов(ln_tq), используется метод множественной линейной регрессии (Multiple Linear Regression).
Данный метод позволяет оценить как совместное влияние всех ESG-компонентов, так и вклад каждого из них по отдельности, контролируя их взаимную зависимость.

Мы будем анализировать два ключевых аспекта:

Общую значимость модели (F-statistic): Этот тест проверяет "общую" H0 (βE = βS = βG = 0), то есть гипотезу о том, что все компоненты ESG вместе не имеют статистически значимого влияния.

Индивидуальную значимость (t-statistics): Этот тест позволяет оценить, вносит ли конкретный компонент (ln_e, ln_s или ln_g) значимый вклад в объяснение ln_tq, при условии наличия в модели остальных факторов.

```{r}
library(zoo)
cat("Результаты по Гипотезе 1")

# H0: Компоненты не оказывают влияния (β_E = β_S = β_G = 0)
# H1: Хотя бы один компонент оказывает влияние β != 0

model_h1 <- lm(ln_tq ~ ln_e + ln_s + ln_g, data = data_ea)

#install.packages("lmtest")   # если ещё не установлен
library(lmtest)
dwtest(model_h1)
```

Для проверки независимости остатков был использован тест Дарбина–Уотсона.
Полученное значение статистики **DW = 0.85**, что заметно ниже 2 и указывает на наличие положительной автокорреляции остатков.
Таким образом, предпосылка независимости наблюдений *формально нарушена*.

```{r}
plot(model_h1, which = 1)  
```

```{r}
library(car)
avPlots(model_h1)
```

Модель линейна.

```{r}
bptest(model_h1)
```
Модель  не имеет статистически значимой гетероскедастичности *p = 0.1847*

```{r}
vif(model_h1)
```

Предпосылка отсутствия мультиколлинеарности отсутствует.
Значения VIF указывают на то, что ln_e, ln_s и ln_g не создают проблем мультиколлинеарности, а их совместное использование в регрессионной модели является корректным.

```{r}
plot(cooks.distance(model_h1))
```

Отсутсвуют значимые выбросы.

```{r}
qqnorm(residuals(model_h1))
qqline(residuals(model_h1))
```

Отклонений нету.

```{r}
# Выводим F-статистику (общая значимость) и t-статистики (индивидуальные)
summary(model_h1)

# Выводы по F-statistic (внизу): если p-value < 0.05, модель в целом значима (H1).
# Выводы по Coefficients (Estimate и Pr(>|t|)):
#   - Estimate показывает направление (+/-)
#   - Pr(>|t|) < 0.05 показывает значимость отдельного фактора.
```

На основании результатов регрессионного анализа, где мы исследовали влияние компонентов ESG (ln_e, ln_s, ln_g) на операционную маржу (ln_op_margin), можно сделать следующие выводы:

**1. Общая значимость модели Проверка H0:**

Все $\beta = 0$

F-статистика: $48.98$

P-value: $6.127\text{e-}15$ (очень мало)

Вывод: Поскольку $p$-value для $F$-статистики значительно меньше стандартного уровня значимости $\alpha = 0.05$, нулевая гипотеза (H0) о том, что все компоненты ESG не оказывают статистически значимого влияния на $\text{ln_op_margin}$, отвергается.
Мы с уверенностью принимаем альтернативную гипотезу (H1): по крайней мере один из компонентов ESG статистически значимо связан с коэффициентом Тобина..

**2. Индивидуальное влияние компонентов (t-тесты)**

Экологический компонент ($\text{ln_e}$): коэффициент $\beta_E =-0.291924$ является статистически значимым ($p < 0.001$).
Знак коэффициента отрицательный, что означает: при прочих равных условиях, более высокий экологический рейтинг компании ассоциирован с более низким значением логарифма Тобина Q.

Поскольку Тобин Q отражает рыночную стоимость компании относительно её балансовой (восстановительной) стоимости, отрицательная связь может свидетельствовать о том, что инвесторы не дооценивают или даже наказывают компании за высокие экологические стандарты возможно, воспринимая их как источник краткосрочных издержек, снижающих прибыльность или ликвидность.

Альтернативно, это может отражать реальные дополнительные затраты на экологические инициативы (например, очистные технологии, переход на ВИЭ, утилизация отходов), которые в краткосрочной и среднесрочной перспективе не компенсируются ростом доходов, но воспринимаются рынком как снижение эффективности.

Социальный компонент ($\text{ln_s}$): коэффициент $\beta_S =0.056772$ статистически  не значим ($p = 0.100$).
Тем не менее, при уровне значимости 10% наблюдается слабая положительная тенденция: компании с более высоким социальным рейтингом имеют незначительно более высокий Тобин Q. Однако существенных доказательств связи между социальной ответственностью и рыночной стоимостью компании в рамках данной модели не обнаружено.

Управленческий компонент ($\text{ln_g}$): коэффициент $\beta_G = 0.006552$ статистически не значим на стандартном уровне $0.05$, ($p = 0.873$).
Это указывает на отсутствие какой-либо связи между управленческим компонентом ESG и Тобином Q: изменения в уровне корпоративного управления не ассоциированы с изменениями рыночной оценки компании.

**3. Качество модели**

$R^2$ (Multiple R-squared): $0.06964$

Вывод: Значение $R^2$ крайне низкое ($6.964\%$).
Это означает, что включённые ESG-компоненты объясняют менее 7% общей дисперсии логарифма Тобина Q. Несмотря на статистическую значимость модели в целом, её объяснительная способность ограничена.

Подавляющая часть вариации рыночной оценки компаний, вероятно, обусловлена факторами, не включёнными в данную спецификацию, такими как отраслевая принадлежность, макроэкономическая конъюнктура, размер компании, географическое расположение или финансовые показатели (доход, долг, выручка и др.).

Гипотеза H1 подтверждается: только экологический компонент $\text{ln_e}$ оказывает статистически значимое влияние на $\text{ln_tq}$.
Экономически это может интерпретироваться как эффект «платы за экологичность»: компании с более высоким экологическим рейтингом демонстрируют ниже рыночную оценку (Тобин Q), что может отражать восприятие инвесторами экологических инициатив как источника краткосрочных издержек, не компенсируемых немедленным ростом прибыли или эффективности. Таким образом, рынок, по крайней мере в краткосрочной перспективе, не вознаграждает, а скорее штрафует компании за высокие экологические стандарты.

*Гипотеза 2: Влияние tb_q на E, S, G*

Для проверки влияния коэффициента Тобина (Tobin Q) на компоненты ESG была использована многомерная дисперсионная анализ (MANOVA). Данный метод подходит здесь лучше всего, поскольку позволяет оценить влияние независимой переменной одновременно на несколько взаимосвязанных зависимых переменных — в данном случае на три компоненты ESG: *E Score*, *S Score* и *G Score*.

Компоненты ESG, как правило, коррелируют между собой, поэтому применение отдельных одномерных регрессий может привести к искажению выводов и увеличению вероятности ошибки первого рода. Использование MANOVA позволяет учитывать взаимосвязь между зависимыми переменными и проверять влияние *Tobin Q* на ESG в совокупности, а не по отдельности. Это делает выводы более надежными и статистически корректными.

Кроме того, MANOVA позволяет оценить общий эффект Tobin Q на многомерный набор показателей ESG, что важно в условиях, когда каждая из составляющих отражает различные аспекты устойчивости компаний.

```{r}
model_2 <- manova(cbind(ln_e, ln_s, ln_g) ~ ln_tq, data = data_ea)
summary(model_2, test = "Wilks")
```
```{r}
summary(model_2, test = "Pillai")
```
По результатам MANOVA было выявлено, что отношение рыночной стоимости к стоимости активов (ln_tq) оказывает статистически значимое влияние на компоненты ESG в совокупности (ln_e, ln_s, ln_g). Это подтверждается результатами тестов Wilks’ Lambda (p < 2.2e−16) и Pillai’s Trace (p < 2.2e−16). Следовательно, нулевая гипотеза об отсутствии влияния отвергается.

```{r}
summary.aov(model_2)
```
Анализ показал, что коэффициент Тобина (Tobin Q), то есть отношение рыночной стоимости компании к стоимости её активов, действительно влияет на все три компоненты ESG.

Больше всего Tobin Q связан с E Score - это **экологика** ESG: влияние очень сильное и высоко значимое (p < 2.2e−16).
На S Score — **социальную** составляющую — влияние тоже есть, но уже не такое выраженное (p = 2.87e−09).
На G Score — **управленческую часть** — влияние остаётся значимым, хотя оно самое слабое среди всех трёх показателей (p = 0.0035).

В целом можно сказать, что рост коэффициента Тобина статистически заметно связан с изменениями во всех компонентах ESG, просто эта связь выражена по-разному для E, S и G.
Используем для фиксированных значений, то есть model_fe

Тест на гетероскедантичность:

```{r}
library(lmtest)

m_e <- lm(ln_e ~ ln_tq, data = data_ea)
m_s <- lm(ln_s ~ ln_tq, data = data_ea)
m_g <- lm(ln_g ~ ln_tq, data = data_ea)

bptest(m_e)
bptest(m_s)
bptest(m_g)
```

Тест Бройша–Пагана показал, что в модели для экологического компонента ESG (E Score) наблюдается значимая гетероскедастичность (p < 0.001). В моделях для социального (S Score) и управленческого (G Score) компонентов статистически значимых признаков гетероскедастичности не выявлено (p > 0.05). Это означает, что для оценки модели E Score необходимо использовать робастные стандартные ошибки, тогда как модели S и G могут интерпретироваться в обычной форме.

```{r}
summary(model_2)
```

**Вывод:**
Результаты теста Pillai’s Trace показали, что коэффициент Тобина (ln_tq) оказывает статистически значимое влияние на компоненты ESG в совокупности. Значение статистики Pillai составляет 0.0711, а соответствующее F-значение — 48.98 при числе степеней свободы 3 и 1920. Полученное p-value < 2.2e−16, что значительно меньше уровня значимости 0.05.

Это означает, что нулевая гипотеза об отсутствии влияния ln_tq на многомерный вектор ESG-показателей отвергается. Иначе говоря, ln_tq статистически значимо связан с ESG-показателями E, S и G, рассматриваемыми одновременно.




-----------------------------------
```{r}
data_ea_counts <- data_ea |> select('country_of_headquarters', 'e_score', 's_score', 'g_score')
data_ea_counts  
```

```{r}
country_counts <- data_ea_counts |>
  count(`country_of_headquarters`) |>
  arrange(desc(n))
country_counts
```

```{r}
knitr::opts_chunk$set(
      cache = FALSE)
country_data <- tibble::tribble(
  ~"Country of Headquarters", ~n,
  "China", 1093,
  "Japan", 649,
  "Korea; Republic (S. Korea)", 182
)


bp <- barplot(height = country_data$n,  
              names.arg = country_data$`Country of Headquarters`,
              main = 'Страна штаб-квартиры',
              col = c('lightblue', 'lightgreen', 'salmon'),
              xlab = "Страна",
              ylab = "Количество компаний",
              ylim = c(0, 1200), 
              axes = FALSE)

# Добавляем ось Y
axis(2, at = seq(from = 0, to = 1200, by = 300))

# Добавляем подписи значений
text(x = bp, 
     y = country_data$n + 10,  
     labels = country_data$n,
     pos = 3,  
     col = "black",
     font = 2)
```

По графику видно, что Китай преобладает над Японией и Северной Кореей.

```{r}
library(psych)
library(skimr)
library(corrplot)
library(GGally)
```

#### Общая информация о данных

```{r}
cat("Период данных:", min(data_ea$year), "-", max(data_ea$year), "\n")
cat("Общее количество наблюдений:", nrow(data_ea), "\n")
cat("Количество уникальных компаний:", length(unique(data_ea$company_common_name)), "\n")
cat("Количество стран:", length(unique(data_ea$country_of_headquarters)), "\n")
cat("Количество отраслей (GICS):", length(unique(data_ea$gics_industry_name)), "\n")
cat("Количество лет:", length(unique(data_ea$year)), "\n\n")
```

#### Распределение по странам(уникальные значения 701)

```{r}
country_dist <- data_ea |>
  distinct(company_common_name, country_of_headquarters) |>
  count(country_of_headquarters) |>
  mutate(percent = round(n/701*100, 1))
country_dist
```

Китай - 449 компаний (64.1%) Япония - 189 компаний (27%) Южная Корея - 63 компании (9%)

#### Основные показатели (усрдненные)

```{r}
company_avg <- data_ea |>
  group_by(company_common_name) |>
  summarise(
    esg = mean(esg_score),
    roa = mean(roa) * 100,
    leverage = mean(leverage) * 100,
    op_margin = mean(op_margin) * 100,
    .groups = 'drop'
  )

key_stats <- company_avg |>
  summarise(
    `ESG Score` = sprintf("%.1f (%.1f)", mean(esg), sd(esg)),
    `ROA (%)` = sprintf("%.2f (%.2f)", mean(roa), sd(roa)),
    `leverage (%)` = sprintf("%.1f (%.1f)", mean(leverage), sd(leverage)),
    `op_margin (%)` = sprintf("%.1f (%.1f)", mean(op_margin), sd(op_margin))
  )

key_stats
```

*ESG Score*: Средний уровень ESG - компании показывают умеренные результаты.
Высокая вариативность (стандартное отклонение 19.4) - огромный разброс между лидерами и аутсайдерами.
Вывод: Значительные различия в качестве ESG.

*ROA*: Экстремально высокие значения, явные выбросы.
Нереалистичные цифры, тк ROA редко превышает 20-30%.
Вывод: В данном случае подразуммевается чистка данных, но в массиве предоставлены разные компании, которые аналогично имеют разные показатели.
Следовательно,

*leverage*: Умеренная долговая нагрузка в среднем.
Компании сильно различаются по структуре капитала.
Вывод: Разные финансовые стратегии компаний.

*op_margin*: Здоровая рентабельность операционной деятельности.
Умеренная вариативность по сравнению с другими показателями.
Вывод: Стабильные операционные результаты.

#### Топ-5 отраслей

```{r}
data_ea |>
  distinct(company_common_name, gics_industry_name) |>
  count(gics_industry_name, name = "компаний") |>
  top_n(5, компаний) |>
  arrange(desc(компаний)) |> 
  print()
```

Преобладают промышленные и производственные сектора.

```{r}
year_distribution <- data_ea |>
  count(year, gics_industry_name) |>
  group_by(year) |>
  mutate(percentage = n / sum(n) * 100) |>
  slice_max(n, n = 5) |>
  arrange(year, desc(n))

year_distribution
```

Обратим внимание, что в каждом году Химическая индустрия остается на первом месте.
В 2022 году Электронное оборудование, инструменты и компоненты уступают металлам и горнодобывающей промышленности.
А потом опять преуспевают в 2023 году.

### Описателльная статистика E, S и G

```{r}
library(dplyr)
library(ggplot2)
library(psych)
library(knitr)
```

```{r}
esg_vars <- c("e_score", "s_score", "g_score")

esg_vars <- esg_vars[esg_vars %in% names(data_ea)]

# Считаем описательную статистику
esg_summary <- data_ea |>
  select(all_of(esg_vars)) |>
  psych::describe() |>
  as.data.frame() |>
  select(mean, sd, median, min, max, skew, kurtosis)

esg_summary
```

Средние значения (mean) показывают, что в целом компании демонстрируют: наивысшие результаты по Governance (G) - 51,9 балла, умеренные - по Environmental (E) - 47,3 балла, наименьшие - по Social (S) - 43,3 балла.

Это говорит нам о том, что компании чаще фокусируются на *управленческой прозрачности и корпоративных стандартах*, чем на *социальных* и *экологических инициативах*.

Стандартные отклонения (sd) достаточно велики (от 21 до 26), что указывает на значительную разницу между компаниями по каждому компоненту — ESG-практики сильно варьируются в зависимости от отрасли и страны.

Асимметрия (skew) близка к нулю для всех трёх показателей, значит, распределения почти симметричны и нет значительного перекоса в сторону очень высоких или очень низких оценок.

Эксцесс (kurtosis) отрицательный -\> распределение данных является относительно сглаженным и имеет более короткие хвосты, где меньше экстремальных значений.

### Средние ESG по годам

```{r}
esg_by_year <- data_ea |>
  group_by(year) |>
  summarise(
    ESG_mean = mean(esg_score, na.rm = TRUE),
    E_mean = mean(e_score, na.rm = TRUE),
    S_mean = mean(s_score, na.rm = TRUE),
    G_mean = mean(g_score, na.rm = TRUE)
  )

esg_by_year
```

```{r}
esg_analysis <- esg_by_year |>
  mutate(
    E_growth = (E_mean - lag(E_mean)) / lag(E_mean) * 100,
    S_growth = (S_mean - lag(S_mean)) / lag(S_mean) * 100,
    G_growth = (G_mean - lag(G_mean)) / lag(G_mean) * 100,
    ESG_growth = (ESG_mean - lag(ESG_mean)) / lag(ESG_mean) * 100
  )

esg_analysis
```

Какие выводы мы можем сдлеать на основании Экологии, социальной сфере и управления(политика?): ESG общий: Рост 6-7% (продолжение ускорения)

Environmental: Рост 8-9% (климатическая повестка)

Social: Рост 9-10% (фокус на человеческий капитал)

Governance: Стагнация или умеренный рост 1-2%

#### График динамики ESG (визуализация по среднему)

```{r}
esg_by_year_long <- esg_by_year |>
  pivot_longer(cols = -year, names_to = "component", values_to = "value")

ggplot(esg_by_year_long, aes(x = year, y = value, color = component)) +
  geom_line(size = 1) +
  geom_point() +
  theme_minimal() +
  labs(title = "Динамика ESG показателей (2020–2023)", y = "Среднее значение", x = "Год")
```

С 2020 по 2023 годы общий ESG-рейтинг компаний постепенно растёт (с 46,2 до 49,8), что отражает повышение внимания бизнеса к устойчивому развитию.

Самый резкий рост наблюдается по экологической сфере.
Компании активнее внедряют «зелёные» инициативы, сокращают выбросы, переходят на возобновляемые источники энергии и экологические стандарты производства.

Социальная сфера также усилился (с 41,2 до 46,1), что может быть связано с ростом значимости условий труда, безопасности и разнообразия персонала.

Управленческая сфера (G) остаётся стабильно высоким, без выраженного роста.

#### Разрез по отраслям

```{r}
# Средние значения по каждой отрасли
industry_esg_detail <- data_ea |>
  group_by(gics_industry_name) |>
  summarise(
    E_mean = mean(e_score, na.rm = TRUE),
    S_mean = mean(s_score, na.rm = TRUE),
    G_mean = mean(g_score, na.rm = TRUE)
  ) |>
  arrange(desc(E_mean))

# График для E
ggplot(industry_esg_detail, aes(x = reorder(gics_industry_name, E_mean), y = E_mean)) +
  geom_col(fill = "lightgreen") +
  coord_flip() +
  theme_minimal(base_size = 12) +
  labs(title = "Средние Environmental (E) Score по отраслям",
       x = "Отрасль", y = "Средний E Score")

# График для S
ggplot(industry_esg_detail, aes(x = reorder(gics_industry_name, S_mean), y = S_mean)) +
  geom_col(fill = "lightblue") +
  coord_flip() +
  theme_minimal(base_size = 12) +
  labs(title = "Средние Social (S) Score по отраслям",
       x = "Отрасль", y = "Средний S Score")

# График для G
ggplot(industry_esg_detail, aes(x = reorder(gics_industry_name, G_mean), y = G_mean)) +
  geom_col(fill = "pink") +
  coord_flip() +
  theme_minimal(base_size = 12) +
  labs(title = "Средние Governance (G) Score по отраслям",
       x = "Отрасль", y = "Средний G Score")
```

На барчарте по E-компоненту видно, что: Лидеры по экологическим инициативам - отрасли телекоммуникаций, высоких технологий и строительства.
Аутсайдеры - медиа, развлечения, ПО и биотехнологии, где экологические процессы менее выражены.

по S-компоненте: Лидерами по социальным показателям являются отрасли телекоммуникаций и здравоохранения.
В то же время, сектора биотехнологий, медиа и программного обеспечения демонстрируют наиболее низкие результаты в этой области.

по G-компоненте: Наивысшие оценки корпоративного управления также у телекоммуникаций, здравоохранения и технологического сектора.
При этом отрасль программного обеспечения и медиа снова оказывается в аутсайдерах, что указывает на системные пробелы в качестве управления компаний этого сектора.
